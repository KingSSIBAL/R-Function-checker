# Autograder C++ Source Code

This directory contains the modular C++ backend for the autograder package.

## ğŸ“ Directory Structure

```
src/
â”œâ”€â”€ core/                    # Core types and exceptions
â”‚   â”œâ”€â”€ types.hpp           # Central type definitions
â”‚   â””â”€â”€ exceptions.hpp      # Exception hierarchy
â”œâ”€â”€ crypto/                  # Encryption module
â”‚   â”œâ”€â”€ encryption.hpp      # Encryption API
â”‚   â”œâ”€â”€ encryption.cpp      # Implementation
â”‚   â””â”€â”€ encrypted_config.hpp # Auto-generated encrypted URL config
â”œâ”€â”€ validation/              # Input validation module
â”‚   â”œâ”€â”€ validator.hpp       # Validation API
â”‚   â””â”€â”€ validator.cpp       # Implementation
â”œâ”€â”€ compare/                 # Object comparison module
â”‚   â”œâ”€â”€ comparator.hpp      # Comparison API
â”‚   â””â”€â”€ comparator.cpp      # Implementation
â”œâ”€â”€ network/                 # Network operations module
â”‚   â”œâ”€â”€ fetcher.hpp         # Network API
â”‚   â””â”€â”€ fetcher.cpp         # Implementation
â”œâ”€â”€ format/                  # Output formatting module
â”‚   â”œâ”€â”€ formatter.hpp       # Formatting API
â”‚   â””â”€â”€ formatter.cpp       # Implementation
â”œâ”€â”€ autograder.hpp          # Main public header
â”œâ”€â”€ autograder_main.cpp     # Rcpp exports
â”œâ”€â”€ Makevars                # Unix build configuration
â””â”€â”€ Makevars.win            # Windows build configuration
```

## ğŸ—ï¸ Architecture

### Module Dependencies

```
autograder.hpp (main API)
    â”‚
    â”œâ”€â”€ core/types.hpp
    â”œâ”€â”€ core/exceptions.hpp
    â”‚
    â”œâ”€â”€ crypto/encryption.hpp â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚       â””â”€â”€ encrypted_config.hpp   â”‚
    â”‚                                  â”‚
    â”œâ”€â”€ validation/validator.hpp       â”‚
    â”‚                                  â”‚
    â”œâ”€â”€ compare/comparator.hpp         â”‚
    â”‚                                  â”‚
    â”œâ”€â”€ network/fetcher.hpp â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ (uses crypto for URL decryption)
    â”‚                                  â”‚
    â””â”€â”€ format/formatter.hpp           â”‚
```

### Module Descriptions

| Module | Purpose | Key Components |
|--------|---------|----------------|
| **core** | Foundation types and exceptions | `Config`, `CryptoResult`, `ValidationResult`, `AutograderException` |
| **crypto** | AES S-box encryption/decryption | `Encryptor`, `KeyDeriver`, `Encoder` |
| **validation** | Input sanitization and security | `Validator::is_valid_function_name()`, `sanitize()` |
| **compare** | High-performance R object comparison | `Comparator::compare()`, tolerance handling |
| **network** | Secure file download | `Fetcher`, `Repository`, URL building |
| **format** | Smart output formatting | `Formatter::format()`, truncation |

## ğŸ”§ Building

The package uses C++17. Build configuration is in `Makevars` and `Makevars.win`.

### Requirements

- C++17 compatible compiler
- Rcpp package installed
- R development headers

### Build Commands

```bash
# From package root
R CMD build .
R CMD INSTALL autograder_*.tar.gz

# Or using devtools
devtools::install()
```

## ğŸ“ Adding New Modules

1. Create a new directory: `src/mymodule/`
2. Add header and implementation: `mymodule.hpp`, `mymodule.cpp`
3. Include in `autograder.hpp`
4. Add to `Makevars` SOURCES
5. Export functions via Rcpp in `autograder_main.cpp`

## âš ï¸ Auto-Generated Files

**Do not manually edit:**
- `encrypted_config.hpp` - Generated by `tools/encrypt_url_helper.R`
- `RcppExports.cpp` - Generated by `Rcpp::compileAttributes()`

## ğŸ“š References

- [Rcpp Documentation](https://www.rcpp.org/)
- [R Extensions Manual](https://cran.r-project.org/doc/manuals/r-release/R-exts.html)
